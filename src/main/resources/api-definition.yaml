#%RAML 0.8
---
title: OpenLMIS Prepacking
version: '@version@'
baseUri: '@baseUrl@'
protocols: [HTTP, HTTPS]

documentation:
  - title: Getting Started
    content: |
      OpenLMIS Prepacking. Prepacking implements CRUD operations for OpenLMIS Prepacking events.

      This service provides the following functionality:
      * Create Prepacking event
      * Get a Prepacking event
      * Get a list of Prepacking events for a given facility
      * Edit/update a Prepacking event
      * Delete a Prepacking event
      *Authorize/Reject a Prepacking event

schemas:
  - program: !include schemas/program.json
  - facility: !include schemas/facility.json
  - facilityType: !include schemas/facilityType.json
  - reason: !include schemas/reason.json
  - reasons: |
      {
          "type": "array",
          "items": { "type": "object", "$ref": "schemas/reason.json" }
      }
  - geographicZone: !include schemas/geographicZone.json
  - prepackingEventDto: !include schemas/prepackingEventDto.json
  - prepackingEventDtos: |
      {
          "type": "array",
          "items": {"type": "object", "$ref": "schemas/prepackingEventDto.json"}
      }
  - pointOfDeliveryEventDto: !include schemas/pointOfDeliveryEventDto.json
  - pointOfDeliveryEventDtos: |
      {
          "type": "array",
          "items": {"type": "object", "$ref": "schemas/pointOfDeliveryEventDto.json"}
      }
  - validSourceDestination: !include schemas/validSourceDestination.json
  - validSourceDestinations: |
      {
          "type": "array",
          "items": {"type": "object", "$ref": "schemas/validSourceDestination.json"}
      }
  - validReasonAssignment: !include schemas/validReasonAssignment.json
  - validReasonAssignments: |
      {
          "type": "array",
          "items": {"type": "object", "$ref": "schemas/validReasonAssignment.json"}
      }
  - organization: !include schemas/organization.json
  - organizations: |
      {
          "type": "array",
          "items": {"type": "object", "$ref": "schemas/organization.json"}
      }
  - localizedMessage: !include schemas/localizedMessage.json
  - uuid: |
      {
        "type": "string",
        "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
      }
  - arrayOfStrings: |
      {
        "type": "array",
        "items": {
          "type": "string"
        }
      }

resourceTypes:
  - collection:
      get:
        responses:
          200:
            description: Collection retrieved successfully
            headers:
              X-Content-Type-Options:
              X-XSS-Protection:
            body:
              application/json:
                schema: <<schema>>
          404:
            description: Collection is empty.
            headers:
              X-Content-Type-Options:
              X-XSS-Protection:
      post:
        body:
          application/json:
            schema: <<schema>>
        responses:
          201:
            description: Item created successfully
            headers:
              X-Content-Type-Options:
              X-XSS-Protection:
            body:
              application/json:
                schema: <<schema>>
  - member:
      get:
        responses:
          200:
            body:
              application/json:
                schema: <<schema>>
      post:
        body:
          application/json:
            schema: <<schema>>
        responses:
          200:
            body:
              application/json:
                schema: <<schema>>
      delete:
        responses:
          200:

traits:
  - secured:
      queryParameters:
        access_token:
          displayName: access_token
          description: OAuth2 access token
          type: string
          required: false
          repeat: false
      headers:
        Authorization:
          displayName: Authorization
          description: OAuth2 authorization token header. Takes the form of 'Bearer <token>'.
          type: string
          required: false
          repeat: false

  - paginated:
      queryParameters:
        page:
          description: The page number which should be displayed. Note that the first page is numbered zero rather than one. Additionally, negative and undefined values are interpreted as zero.
          type: integer
          required: false
          repeat: false
        size:
          description: The desired size of each page. This specifies the maximum number of values that should be returned by the server. Zero, undefined, and negative values should result in all possible values being returned.
          type: integer
          required: false
          repeat: false
  - sorted:
      queryParameters:
        sort:
          description: Sorting criteria in the format "property(,asc|desc)". Default sort order is ascending. Multiple sort criteria are supported.
          type: string
          required: false
          repeat: true

/api:
  /prepackingEvents:
    get:
      is: [secured]
      description: Get a list of point of delivery events
      queryParameters:
        destinationId:
          required: true

      responses:
        200:
          description: |
            Returns a default templte with all fields set to not display when no query parameters are passed.

            Returns template that matches destination id.
          headers:
            X-Content-Type-Options:
            X-XSS-Protection:
          body:
            application/json:
              schema: pointOfDeliveryEventDtos
        404:
          description: Point of delivery events not found for the given query parameter.
          body:
            application/json:
              schema: localizedMessage
        400:
          body:
            application/json:
              schema: localizedMessage
          description: Provided query parameters are not correctly formatted.

    post:
      is: [secured]
      description: Create a new prepacking event.
      body:
        application/json:
          schema: prepackingEventDto

      responses:
        201:
          description: Prepacking event has been processed with no validation error or persistence error.
          headers:
            Keep-Alive:
          body:
            application/json:
              schema: uuid

        400:
          description: Failed to process prepacking event due to validation error.
          body:
            application/json:
              schema: localizedMessage

        403:
          description: User does not have permission to create prepacking events for given facility (destination).
          body:
            application/json:
              schema: localizedMessage

    /{id}/authorize:
          uriParameters:
              id:
                  displayName: prepacking Id
                  type: string
                  required: true
                  repeat: false
          post:
              is: [ secured ]
              description: Authorize prepackingEvent
              responses:
                  "200":
                      headers:
                        Keep-Alive:
                      body:
                        application/json:
                            schema: prepackingEventDto
                  "400":
                      body:
                        application/json:
                            schema: localizedMessage
                  "404":
                  "403":
                      headers:
                        Keep-Alive:
                      body:
                        application/json:
                            schema: localizedMessage
                  "409":
                      headers:
                        Keep-Alive:
                      body:
                        application/json:
                            schema: localizedMessage
    /{id}/reject:
          uriParameters:
              id:
                  displayName: prepacking Id
                  type: string
                  required: true
                  repeat: false
          post:
              is: [ secured ]
              description: Reject prepackingEvent
              responses:
                  "200":
                      headers:
                        Keep-Alive:
                      body:
                        application/json:
                            schema: prepackingEventDto
                  "400":
                      body:
                        application/json:
                            schema: localizedMessage
                  "404":
                  "403":
                      headers:
                        Keep-Alive:
                      body:
                        application/json:
                            schema: localizedMessage
                  "409":
                      headers:
                        Keep-Alive:
                      body:
                        application/json:
                            schema: localizedMessage

    /{id}:
      uriParameters:
        id:
          displayName: id
          type: string
          required: true
          repeat: false
      put:
        is: [secured]
        description: Update point of delivery event.
        body:
          application/json:
            schema: pointOfDeliveryEventDto

        responses:
          200:
            description: Point of delivery event updated.
            headers:
              Keep-Alive:
            body:
              application/json:
                schema: pointOfDeliveryEventDto
          400:
            body:
              application/json:
                schema: localizedMessage
            description: An error occured during request processing.

          403:
            description: User does not have permission to save a point of delivery event.
            body:
              application/json:
                schema: localizedMessage
      delete:
        is: [secured]
        description: Delete a Prepacking event.

        responses:
          204:
            description: Prepacking event deleted.
          400:
            description: Prepacking event is not found.
            body:
              application/json:
                schema: localizedMessage
          403:
            description: User does not have permission to delete a Prepacking event.
            body:
              application/json:
                schema: localizedMessage
